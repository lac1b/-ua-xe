<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Game Đua Xe</title>
    <style>
      body {
        margin: 0;
        background: #222;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      canvas {
        background: #333;
        display: block;
        border: 3px solid #fff;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      // Làn đường
      const laneCount = 3;
      const laneWidth = canvas.width / laneCount;
      const roadMargin = 20;

      // Xe của người chơi
      const player = {
        lane: 1, // giữa (0 = trái, 1 = giữa, 2 = phải)
        x: 0,
        y: canvas.height - 100,
        width: 50,
        height: 80,
        color: "#0f0",
      };

      // Xe đối thủ
      let enemies = [];
      let enemyTimer = 0;
      let enemyInterval = 90;

      // Game state
      let score = 0;
      let gameOver = false;
      let speed = 4;

      function resetPlayerX() {
        player.x = player.lane * laneWidth + laneWidth / 2 - player.width / 2;
      }
      resetPlayerX();

      function drawRoad() {
        ctx.fillStyle = "#555";
        ctx.fillRect(
          roadMargin,
          0,
          canvas.width - roadMargin * 2,
          canvas.height
        );

        // vạch phân làn
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 2;
        for (let i = 1; i < laneCount; i++) {
          ctx.setLineDash([20, 20]);
          ctx.beginPath();
          ctx.moveTo(i * laneWidth, 0);
          ctx.lineTo(i * laneWidth, canvas.height);
          ctx.stroke();
        }
        ctx.setLineDash([]);
      }

      function drawPlayer() {
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.width, player.height);
      }

      function drawEnemies() {
        ctx.fillStyle = "#f00";
        enemies.forEach((e) => {
          ctx.fillRect(e.x, e.y, e.width, e.height);
        });
      }

      function updateEnemies() {
        enemyTimer++;
        if (enemyTimer > enemyInterval) {
          enemyTimer = 0;
          let lane = Math.floor(Math.random() * laneCount);
          let x = lane * laneWidth + laneWidth / 2 - 25;
          enemies.push({ x: x, y: -100, width: 50, height: 80 });
        }

        enemies.forEach((e) => (e.y += speed));

        enemies = enemies.filter((e) => e.y < canvas.height + 100);
      }

      function checkCollision() {
        enemies.forEach((e) => {
          if (
            player.x < e.x + e.width &&
            player.x + player.width > e.x &&
            player.y < e.y + e.height &&
            player.y + player.height > e.y
          ) {
            gameOver = true;
          }
        });
      }

      function drawHUD() {
        ctx.fillStyle = "#fff";
        ctx.font = "20px Arial";
        ctx.fillText("Điểm: " + score, 20, 30);
        if (gameOver) {
          ctx.fillStyle = "rgba(0,0,0,0.7)";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "#fff";
          ctx.font = "40px Arial";
          ctx.fillText("Game Over", canvas.width / 2 - 100, canvas.height / 2);
          ctx.font = "20px Arial";
          ctx.fillText(
            "Nhấn Space để chơi lại",
            canvas.width / 2 - 120,
            canvas.height / 2 + 40
          );
        }
      }

      function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawRoad();
        drawPlayer();
        drawEnemies();
        drawHUD();

        if (!gameOver) {
          updateEnemies();
          checkCollision();
          score++;
          if (score % 300 === 0) speed += 0.5;
          requestAnimationFrame(gameLoop);
        }
      }

      gameLoop();

      // Điều khiển
      window.addEventListener("keydown", (e) => {
        if (gameOver && e.code === "Space") {
          // reset game
          enemies = [];
          score = 0;
          speed = 4;
          gameOver = false;
          player.lane = 1;
          resetPlayerX();
          gameLoop();
          return;
        }
        if (e.code === "ArrowLeft" && player.lane > 0) {
          player.lane--;
          resetPlayerX();
        }
        if (e.code === "ArrowRight" && player.lane < laneCount - 1) {
          player.lane++;
          resetPlayerX();
        }
      });
    </script>
  </body>
</html>
